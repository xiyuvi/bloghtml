{"title":"nginx反向代理的妙用","slug":"25","date":"2023-04-12T03:29:15.000Z","updated":"2023-04-12T03:29:15.000Z","comments":true,"path":"api/articles/25.json","excerpt":null,"covers":null,"content":"<h2 id=\"不止可以反向代理-还能自定义修改内容\"><a href=\"#不止可以反向代理-还能自定义修改内容\" class=\"headerlink\" title=\"不止可以反向代理,还能自定义修改内容\"></a>不止可以反向代理,还能自定义修改内容</h2><p>Nginx是一个高性能的HTTP服务器，它可以实现反向代理的功能，即将客户端的请求转发到后端的服务器，并将后端服务器的响应返回给客户端。这样可以实现负载均衡、安全防护、缓存加速等目的。但是，有时候我们不仅仅想要转发请求和响应，还想要对目标网站的内容进行一些自定义的修改，比如替换某些字符串、添加或删除某些标签、修改某些链接等。这种情况下，我们就需要使用Nginx的内容替换模块，即ngx_http_sub_module模块。</p>\n<p>ngx_http_sub_module模块是一个过滤器，它可以修改网站响应内容中的字符串。这个模块已经内置在Nginx中，但是默认未安装，需要安装需要加上配置参数：–with-http_sub_module。如果已经安装Nginx,只需要再添加这个模块就可以了。安装完成后，我们就可以在Nginx的配置文件中使用sub_filter指令来设置需要替换的字符串和新的字符串。例如：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">server</span> &#123;<br>    <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">80</span>;<br>    <span class=\"hljs-attribute\">server_name</span> www.example.com;<br><br>    <span class=\"hljs-section\">location</span> / &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span> http://127.0.0.1:8080;<br>        <span class=\"hljs-attribute\">proxy_redirect</span> <span class=\"hljs-literal\">off</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;原内容&#x27;</span> <span class=\"hljs-string\">&#x27;替换成的内容&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter_once</span> <span class=\"hljs-literal\">on</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n<p>这样，当我们访问 <a href=\"http://www.example.com/\">www.example.com</a> 时，Nginx会将请求转发到127.0.0.1:8080，并将响应内容中的’原内容’替换成’替换成的内容’，然后返回给客户端。注意，sub_filter_once指令表示只替换第一次匹配到的字符串，如果想要替换所有匹配到的字符串，可以设置为off。</p>\n<h2 id=\"三个实例\"><a href=\"#三个实例\" class=\"headerlink\" title=\"三个实例\"></a>三个实例</h2><p>使用Nginx进行反向代理后自定义修改目标网站内容的用处有很多，例如：</p>\n<ul>\n<li>可以实现网页内容定制化，根据不同的客户端或用户需求，显示不同的内容或样式。</li>\n<li>可以实现网页内容优化，比如去除一些无用的标签或注释，减少网页大小和加载时间。</li>\n<li>可以实现网页内容安全化，比如过滤掉一些恶意的脚本或链接，防止网页被篡改或劫持(ps:替换原网站内容在某种情况下已经可以算是篡改了吧)。</li>\n<li>可以实现网页内容扩展化，比如添加一些额外的内容。</li>\n</ul>\n<p>下面是三段示例代码,由简到难使用了Nginx反向代理后自定义内容的功能。<br>1.第一段代码是给原有的网页注入了一段本地js;<br>2.第二段反向代理某网站后,会在原网站的登录页注入一个js脚本,实现了对element输入框的自动登录效果;<br>3.第三段代码是局域网服务器无法访问高德api时,在有公网权限的服务器上使用Nginx反向代理高德api后,将原有js中的地址替换成本地代理的地址;<em><a href=\"https://blog.csdn.net/cbb0201/article/details/111143619\">点击跳转至原作者网站</a></em></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">server &#123;<br>    listen 80;<br>    server_name www.example.com;<br><br>    location / &#123;<br>        proxy_pass http://127.0.0.1:8080;<br>        proxy_redirect off;<br>        sub_filter &#x27;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/js/app.skd78945.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>&#x27; &#x27;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/js/app.skd78945.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&quot;本地js执行成功&quot;</span>)</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>&#x27;;<br>        sub_filter_once on;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">server &#123;<br>    listen <span class=\"hljs-number\">80</span>;<br>    server_name www.example.com;<br><br>    location<span class=\"hljs-operator\"> / </span>&#123;<br>        proxy_pass http:<span class=\"hljs-comment\">//127.0.0.1:8080;</span><br>        proxy_redirect off;<br>        sub_filter &#x27;&lt;/body&gt;<span class=\"hljs-character\">&#x27; &#x27;</span>&lt;script&gt;<span class=\"hljs-keyword\">let</span> name=document.get<span class=\"hljs-constructor\">ElementsByTagName(&#x27;<span class=\"hljs-params\">input</span>&#x27;)</span><span class=\"hljs-literal\">[<span class=\"hljs-number\">0</span>]</span>;name.value=<span class=\"hljs-string\">&quot;woshiyonghuming&quot;</span>;const event1 = document.create<span class=\"hljs-constructor\">Event(<span class=\"hljs-string\">&quot;HTMLEvents&quot;</span>)</span>;event1.init<span class=\"hljs-constructor\">Event(<span class=\"hljs-string\">&quot;input&quot;</span>, <span class=\"hljs-params\">false</span>, <span class=\"hljs-params\">true</span>)</span>;name.dispatch<span class=\"hljs-constructor\">Event(<span class=\"hljs-params\">event1</span>)</span>;<span class=\"hljs-keyword\">let</span> pass=document.get<span class=\"hljs-constructor\">ElementsByTagName(<span class=\"hljs-string\">&quot;input&quot;</span>)</span><span class=\"hljs-literal\">[<span class=\"hljs-number\">2</span>]</span>;pass.value=woshimima&#x27;;const event2 = document.create<span class=\"hljs-constructor\">Event(<span class=\"hljs-string\">&quot;HTMLEvents&quot;</span>)</span>;event2.init<span class=\"hljs-constructor\">Event(<span class=\"hljs-string\">&quot;input&quot;</span>, <span class=\"hljs-params\">false</span>, <span class=\"hljs-params\">true</span>)</span>;pass.dispatch<span class=\"hljs-constructor\">Event(<span class=\"hljs-params\">event2</span>)</span>;document.get<span class=\"hljs-constructor\">ElementsByTagName(<span class=\"hljs-string\">&quot;button&quot;</span>)</span><span class=\"hljs-literal\">[<span class=\"hljs-number\">0</span>]</span>.click<span class=\"hljs-literal\">()</span>&lt;/script&gt;&lt;/body&gt;&#x27;;<br>        sub_filter_once on;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">server</span> &#123;<br>    <span class=\"hljs-attribute\">listen</span>       <span class=\"hljs-number\">80</span>;<br>    <span class=\"hljs-attribute\">server_name</span>  localhost;<br>    <span class=\"hljs-comment\">#add_header Access-Control-Allow-Origin *;</span><br>    <span class=\"hljs-attribute\">add_header</span> Access-Control-Allow-Headers X-Requested-With;<br>    <span class=\"hljs-attribute\">add_header</span> Access-Control-Allow-Methods GET,POST,OPTIONS;<br>    <span class=\"hljs-section\">location</span> / &#123;<br>            <span class=\"hljs-attribute\">root</span> html;<br>            <span class=\"hljs-attribute\">index</span>  index.html index.htm;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /restapi/ &#123;<br>            <span class=\"hljs-attribute\">proxy_pass</span> https://restapi.amap.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webapi/ &#123;<br>            <span class=\"hljs-attribute\">proxy_pass</span> https://webapi.amap.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /vdata/ &#123;<br>            <span class=\"hljs-attribute\">proxy_pass</span> https://vdata.amap.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /wprd01/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://wprd01.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /wprd02/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://wprd02.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /wprd03/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://wprd03.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /wprd04/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://wprd04.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webrd01/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://webrd01.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webrd02/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://webrd02.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webrd03/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://webrd03.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webrd04/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://webrd04.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /style_icon/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   http://vdata.amap.com/style_icon/;<br>    &#125;<br>    <span class=\"hljs-comment\">#代理获取js api文件并修改文件内容</span><br>    <span class=\"hljs-section\">location</span> /maps &#123;<br>        <span class=\"hljs-attribute\">proxy_set_header</span> Accept-Encoding <span class=\"hljs-string\">&quot;&quot;</span>;<br>        <span class=\"hljs-attribute\">proxy_pass</span> https://webapi.amap.com/maps;<br>        <span class=\"hljs-attribute\">sub_filter_types</span> *;<span class=\"hljs-comment\">#重要·对所有请求响应类型都进行替换</span><br>        <span class=\"hljs-attribute\">sub_filter_once</span> <span class=\"hljs-literal\">off</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;http://webapi.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;http://代理服务器ip/webapi&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;https://webapi.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;http://代理服务器ip/webapi&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;http://restapi.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;http://代理服务器ip/restapi&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;http://vdata.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;http://代理服务器ip/vdata&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;vdata.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/vdata&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;webapi.amap.com/count&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/webapi/count&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;wprd0&#123;1,2,3,4&#125;.is.autonavi.com&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/wprd0&#123;1,2,3,4&#125;&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;webapi.amap.com/theme&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/webapi/theme&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;restapi.amap.com/v4&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/restapi/v4&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;webapi.amap.com/style&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/webapi/style&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>","more":"<h2 id=\"不止可以反向代理-还能自定义修改内容\"><a href=\"#不止可以反向代理-还能自定义修改内容\" class=\"headerlink\" title=\"不止可以反向代理,还能自定义修改内容\"></a>不止可以反向代理,还能自定义修改内容</h2><p>Nginx是一个高性能的HTTP服务器，它可以实现反向代理的功能，即将客户端的请求转发到后端的服务器，并将后端服务器的响应返回给客户端。这样可以实现负载均衡、安全防护、缓存加速等目的。但是，有时候我们不仅仅想要转发请求和响应，还想要对目标网站的内容进行一些自定义的修改，比如替换某些字符串、添加或删除某些标签、修改某些链接等。这种情况下，我们就需要使用Nginx的内容替换模块，即ngx_http_sub_module模块。</p>\n<p>ngx_http_sub_module模块是一个过滤器，它可以修改网站响应内容中的字符串。这个模块已经内置在Nginx中，但是默认未安装，需要安装需要加上配置参数：–with-http_sub_module。如果已经安装Nginx,只需要再添加这个模块就可以了。安装完成后，我们就可以在Nginx的配置文件中使用sub_filter指令来设置需要替换的字符串和新的字符串。例如：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">server</span> &#123;<br>    <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">80</span>;<br>    <span class=\"hljs-attribute\">server_name</span> www.example.com;<br><br>    <span class=\"hljs-section\">location</span> / &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span> http://127.0.0.1:8080;<br>        <span class=\"hljs-attribute\">proxy_redirect</span> <span class=\"hljs-literal\">off</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;原内容&#x27;</span> <span class=\"hljs-string\">&#x27;替换成的内容&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter_once</span> <span class=\"hljs-literal\">on</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n<p>这样，当我们访问 <a href=\"http://www.example.com/\">www.example.com</a> 时，Nginx会将请求转发到127.0.0.1:8080，并将响应内容中的’原内容’替换成’替换成的内容’，然后返回给客户端。注意，sub_filter_once指令表示只替换第一次匹配到的字符串，如果想要替换所有匹配到的字符串，可以设置为off。</p>\n<h2 id=\"三个实例\"><a href=\"#三个实例\" class=\"headerlink\" title=\"三个实例\"></a>三个实例</h2><p>使用Nginx进行反向代理后自定义修改目标网站内容的用处有很多，例如：</p>\n<ul>\n<li>可以实现网页内容定制化，根据不同的客户端或用户需求，显示不同的内容或样式。</li>\n<li>可以实现网页内容优化，比如去除一些无用的标签或注释，减少网页大小和加载时间。</li>\n<li>可以实现网页内容安全化，比如过滤掉一些恶意的脚本或链接，防止网页被篡改或劫持(ps:替换原网站内容在某种情况下已经可以算是篡改了吧)。</li>\n<li>可以实现网页内容扩展化，比如添加一些额外的内容。</li>\n</ul>\n<p>下面是三段示例代码,由简到难使用了Nginx反向代理后自定义内容的功能。<br>1.第一段代码是给原有的网页注入了一段本地js;<br>2.第二段反向代理某网站后,会在原网站的登录页注入一个js脚本,实现了对element输入框的自动登录效果;<br>3.第三段代码是局域网服务器无法访问高德api时,在有公网权限的服务器上使用Nginx反向代理高德api后,将原有js中的地址替换成本地代理的地址;<em><a href=\"https://blog.csdn.net/cbb0201/article/details/111143619\">点击跳转至原作者网站</a></em></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">server &#123;<br>    listen 80;<br>    server_name www.example.com;<br><br>    location / &#123;<br>        proxy_pass http://127.0.0.1:8080;<br>        proxy_redirect off;<br>        sub_filter &#x27;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/js/app.skd78945.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>&#x27; &#x27;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/js/app.skd78945.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&quot;本地js执行成功&quot;</span>)</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>&#x27;;<br>        sub_filter_once on;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs reasonml\">server &#123;<br>    listen <span class=\"hljs-number\">80</span>;<br>    server_name www.example.com;<br><br>    location<span class=\"hljs-operator\"> / </span>&#123;<br>        proxy_pass http:<span class=\"hljs-comment\">//127.0.0.1:8080;</span><br>        proxy_redirect off;<br>        sub_filter &#x27;&lt;/body&gt;<span class=\"hljs-character\">&#x27; &#x27;</span>&lt;script&gt;<span class=\"hljs-keyword\">let</span> name=document.get<span class=\"hljs-constructor\">ElementsByTagName(&#x27;<span class=\"hljs-params\">input</span>&#x27;)</span><span class=\"hljs-literal\">[<span class=\"hljs-number\">0</span>]</span>;name.value=<span class=\"hljs-string\">&quot;woshiyonghuming&quot;</span>;const event1 = document.create<span class=\"hljs-constructor\">Event(<span class=\"hljs-string\">&quot;HTMLEvents&quot;</span>)</span>;event1.init<span class=\"hljs-constructor\">Event(<span class=\"hljs-string\">&quot;input&quot;</span>, <span class=\"hljs-params\">false</span>, <span class=\"hljs-params\">true</span>)</span>;name.dispatch<span class=\"hljs-constructor\">Event(<span class=\"hljs-params\">event1</span>)</span>;<span class=\"hljs-keyword\">let</span> pass=document.get<span class=\"hljs-constructor\">ElementsByTagName(<span class=\"hljs-string\">&quot;input&quot;</span>)</span><span class=\"hljs-literal\">[<span class=\"hljs-number\">2</span>]</span>;pass.value=woshimima&#x27;;const event2 = document.create<span class=\"hljs-constructor\">Event(<span class=\"hljs-string\">&quot;HTMLEvents&quot;</span>)</span>;event2.init<span class=\"hljs-constructor\">Event(<span class=\"hljs-string\">&quot;input&quot;</span>, <span class=\"hljs-params\">false</span>, <span class=\"hljs-params\">true</span>)</span>;pass.dispatch<span class=\"hljs-constructor\">Event(<span class=\"hljs-params\">event2</span>)</span>;document.get<span class=\"hljs-constructor\">ElementsByTagName(<span class=\"hljs-string\">&quot;button&quot;</span>)</span><span class=\"hljs-literal\">[<span class=\"hljs-number\">0</span>]</span>.click<span class=\"hljs-literal\">()</span>&lt;/script&gt;&lt;/body&gt;&#x27;;<br>        sub_filter_once on;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">server</span> &#123;<br>    <span class=\"hljs-attribute\">listen</span>       <span class=\"hljs-number\">80</span>;<br>    <span class=\"hljs-attribute\">server_name</span>  localhost;<br>    <span class=\"hljs-comment\">#add_header Access-Control-Allow-Origin *;</span><br>    <span class=\"hljs-attribute\">add_header</span> Access-Control-Allow-Headers X-Requested-With;<br>    <span class=\"hljs-attribute\">add_header</span> Access-Control-Allow-Methods GET,POST,OPTIONS;<br>    <span class=\"hljs-section\">location</span> / &#123;<br>            <span class=\"hljs-attribute\">root</span> html;<br>            <span class=\"hljs-attribute\">index</span>  index.html index.htm;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /restapi/ &#123;<br>            <span class=\"hljs-attribute\">proxy_pass</span> https://restapi.amap.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webapi/ &#123;<br>            <span class=\"hljs-attribute\">proxy_pass</span> https://webapi.amap.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /vdata/ &#123;<br>            <span class=\"hljs-attribute\">proxy_pass</span> https://vdata.amap.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /wprd01/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://wprd01.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /wprd02/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://wprd02.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /wprd03/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://wprd03.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /wprd04/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://wprd04.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webrd01/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://webrd01.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webrd02/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://webrd02.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webrd03/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://webrd03.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /webrd04/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   https://webrd04.is.autonavi.com/;<br>    &#125;<br>    <span class=\"hljs-section\">location</span> /style_icon/ &#123;<br>        <span class=\"hljs-attribute\">proxy_pass</span>   http://vdata.amap.com/style_icon/;<br>    &#125;<br>    <span class=\"hljs-comment\">#代理获取js api文件并修改文件内容</span><br>    <span class=\"hljs-section\">location</span> /maps &#123;<br>        <span class=\"hljs-attribute\">proxy_set_header</span> Accept-Encoding <span class=\"hljs-string\">&quot;&quot;</span>;<br>        <span class=\"hljs-attribute\">proxy_pass</span> https://webapi.amap.com/maps;<br>        <span class=\"hljs-attribute\">sub_filter_types</span> *;<span class=\"hljs-comment\">#重要·对所有请求响应类型都进行替换</span><br>        <span class=\"hljs-attribute\">sub_filter_once</span> <span class=\"hljs-literal\">off</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;http://webapi.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;http://代理服务器ip/webapi&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;https://webapi.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;http://代理服务器ip/webapi&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;http://restapi.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;http://代理服务器ip/restapi&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;http://vdata.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;http://代理服务器ip/vdata&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;vdata.amap.com&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/vdata&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;webapi.amap.com/count&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/webapi/count&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;wprd0&#123;1,2,3,4&#125;.is.autonavi.com&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/wprd0&#123;1,2,3,4&#125;&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;webapi.amap.com/theme&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/webapi/theme&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;restapi.amap.com/v4&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/restapi/v4&#x27;</span>;<br>        <span class=\"hljs-attribute\">sub_filter</span> <span class=\"hljs-string\">&#x27;webapi.amap.com/style&#x27;</span> <span class=\"hljs-string\">&#x27;代理服务器ip/webapi/style&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>","categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[{"name":"nodeJs","path":"api/tags/nodeJs.json"}]}