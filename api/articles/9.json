{"title":"ngnix使用CDN后正确获取访客IP","slug":"9","date":"2020-08-30T05:57:39.000Z","updated":"2020-08-30T05:57:39.000Z","comments":true,"path":"api/articles/9.json","excerpt":null,"covers":null,"content":"<p>如果是使用一层cdn，那么在nginx的配置文件http{}字段中加入</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-attribute\">set_real_ip_from</span> <span class=\"hljs-number\">0.0.0.0</span>/<span class=\"hljs-number\">0</span>;<br><span class=\"hljs-attribute\">real_ip_header</span> X-Forwarded-For;<br></code></pre></td></tr></table></figure>\n<p>即可。</p>\n<p>如果是使用了两层或以上cdn(使用了cdn和web防火墙也适用)，那么在nginx的配置文件http{}字段中加入</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-attribute\">set_real_ip_from</span> <span class=\"hljs-number\">0.0.0.0</span>/<span class=\"hljs-number\">0</span>;<br><span class=\"hljs-attribute\">real_ip_header</span> X-Forwarded-For;<br><span class=\"hljs-attribute\">real_ip_recursive</span> <span class=\"hljs-literal\">on</span>;<br></code></pre></td></tr></table></figure>\n<p>即可。</p>\n","more":"<p>如果是使用一层cdn，那么在nginx的配置文件http{}字段中加入</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-attribute\">set_real_ip_from</span> <span class=\"hljs-number\">0.0.0.0</span>/<span class=\"hljs-number\">0</span>;<br><span class=\"hljs-attribute\">real_ip_header</span> X-Forwarded-For;<br></code></pre></td></tr></table></figure>\n<p>即可。</p>\n<p>如果是使用了两层或以上cdn(使用了cdn和web防火墙也适用)，那么在nginx的配置文件http{}字段中加入</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-attribute\">set_real_ip_from</span> <span class=\"hljs-number\">0.0.0.0</span>/<span class=\"hljs-number\">0</span>;<br><span class=\"hljs-attribute\">real_ip_header</span> X-Forwarded-For;<br><span class=\"hljs-attribute\">real_ip_recursive</span> <span class=\"hljs-literal\">on</span>;<br></code></pre></td></tr></table></figure>\n<p>即可。</p>\n","categories":[{"name":"IT","path":"api/categories/IT.json"}],"tags":[]}